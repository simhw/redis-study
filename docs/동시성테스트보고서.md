# 동시성 테스트 보고서

## Pessimistic Lock (비관적 락)

### 적용 방법

좌석 조회 시 `LockModeType.PESSIMISTIC_WRITE` 설정하면 `for update` 쿼리문 실행됩니다.

```
public interface AllocatedSeatJpaRepository extends CrudRepository<AllocatedSeatJpaEntity, Long> {
    @Lock(LockModeType.PESSIMISTIC_WRITE)
    @Query("select a from AllocatedSeatJpaEntity a where a.id in(:ids)")
    Iterable<AllocatedSeatJpaEntity> findAllByIdWithPessimisticLock(List<Long> ids);
}

select
    allocated_seat.allocated_seat_id,
    allocated_seat.reserved,
    allocated_seat.screening_id,
    allocated_seat.seat_id 
from
    allocated_seat 
where
    allocated_seat.allocated_seat_id in (?, ?, ?, ?, ?) for update

```

### 동시성 테스트 결과

- 동시에 10명이 같은 좌석을 예매하는 경우

```
소요시간: 1780ms
StopWatch '': 1.78015525 seconds
----------------------------------------
Seconds       %       Task name
----------------------------------------
1.78015525    100%    

```